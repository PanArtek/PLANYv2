---
import type { BaseLayoutProps } from '../utils/types';
import { SITE_CONFIG } from '../utils/constants';

// Props with SEO defaults
const {
  title,
  description = SITE_CONFIG.description,
  image = '/images/og-image.jpg',
  canonical = Astro.url.pathname,
  noindex = false
} = Astro.props as BaseLayoutProps;

// Construct full URLs for meta tags
const siteUrl = SITE_CONFIG.url;
const fullTitle = title.includes(SITE_CONFIG.name) ? title : `${title} | ${SITE_CONFIG.name}`;
const canonicalUrl = new URL(canonical, siteUrl).toString();
const imageUrl = new URL(image, siteUrl).toString();
---

<!DOCTYPE html>
<html lang="pl" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- SEO Meta Tags -->
    <title>{fullTitle}</title>
    <meta name="description" content={description} />
    <meta name="keywords" content={SITE_CONFIG.keywords} />
    <meta name="author" content={SITE_CONFIG.author} />
    <link rel="canonical" href={canonicalUrl} />
    
    {noindex && <meta name="robots" content="noindex, nofollow" />}
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonicalUrl} />
    <meta property="og:title" content={fullTitle} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={imageUrl} />
    <meta property="og:site_name" content={SITE_CONFIG.name} />
    <meta property="og:locale" content="pl_PL" />
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={canonicalUrl} />
    <meta name="twitter:title" content={fullTitle} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={imageUrl} />
    <meta name="twitter:image:alt" content="FitOut Pro - Kompleksowe wykończenia od A do Z" />
    
    <!-- Additional SEO meta tags -->
    <meta name="language" content="pl" />
    <meta name="geo.region" content="PL" />
    <meta name="geo.placename" content="Poland" />
    <meta name="ICBM" content="52.237049, 21.017532" />
    <meta name="DC.title" content={fullTitle} />
    <meta name="DC.creator" content={SITE_CONFIG.author} />
    <meta name="DC.subject" content="wykończenia, fit-out, remonty, placówki medyczne, biura" />
    <meta name="DC.description" content={description} />
    <meta name="DC.publisher" content={SITE_CONFIG.name} />
    <meta name="DC.language" content="pl" />
    
    <!-- Business-specific meta tags -->
    <meta name="apple-mobile-web-app-title" content="FitOut Pro" />
    <meta name="application-name" content="FitOut Pro" />
    <meta name="msapplication-TileColor" content="#3b82f6" />
    <meta name="theme-color" content="#3b82f6" />
    
    <!-- Enhanced Schema.org JSON-LD -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "@id": "https://panartek.github.io/PLANYv2/#business",
      "name": "FitOut Pro",
      "alternateName": "Kompleksowe Wykończenia",
      "description": "Profesjonalne wykończenia placówek medycznych, biur i lokali komercyjnych. Własny zespół 20+ pracowników, kompleksowe instalacje, działamy w całej Polsce.",
      "url": "https://panartek.github.io/PLANYv2",
      "image": "https://panartek.github.io/PLANYv2/images/og-image.jpg",
      "telephone": "+48 123 456 789",
      "email": "kontakt@fitoutpro.pl",
      "priceRange": "$$-$$$",
      "foundingDate": "2014",
      "numberOfEmployees": "20-25",
      "serviceArea": {
        "@type": "Country",
        "name": "Poland"
      },
      "areaServed": "Poland",
      "hasOfferCatalog": {
        "@type": "OfferCatalog",
        "name": "Usługi wykończeniowe",
        "itemListElement": [
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Wykończenia placówek medycznych",
              "description": "Specializujemy się w wykończeniach zgodnych z wymogami sanitarnymi"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Wykończenia biur i przestrzeni komercyjnych",
              "description": "Nowoczesne środowiska pracy i przestrzenie handlowe"
            }
          },
          {
            "@type": "Offer",
            "itemOffered": {
              "@type": "Service",
              "name": "Instalacje techniczne",
              "description": "Pełen zakres instalacji elektrycznych, hydraulicznych i wentylacyjnych"
            }
          }
        ]
      },
      "address": {
        "@type": "PostalAddress",
        "addressCountry": "PL",
        "addressRegion": "Polska"
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "contactType": "customer service",
        "telephone": "+48 123 456 789",
        "email": "kontakt@fitoutpro.pl",
        "areaServed": "PL",
        "availableLanguage": "Polish",
        "hoursAvailable": {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
          "opens": "08:00",
          "closes": "17:00"
        }
      },
      "sameAs": [
        "https://www.facebook.com/fitoutpro",
        "https://www.linkedin.com/company/fitoutpro"
      ],
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": "4.8",
        "reviewCount": "45",
        "bestRating": "5",
        "worstRating": "1"
      }
    }
    </script>
    
    <!-- Fonts - Inter for professional appearance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    
    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com" />
    <link rel="dns-prefetch" href="//fonts.gstatic.com" />
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" as="script" />
    
    <!-- Sitemap and robots -->
    <link rel="sitemap" type="application/xml" href="/sitemap.xml" />
    
    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>
    <script is:inline>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'GA_MEASUREMENT_ID', {
        page_title: document.title,
        page_location: window.location.href,
        anonymize_ip: true,
        allow_google_signals: false,
        allow_ad_personalization_signals: false
      });
      
      // Enhanced ecommerce tracking for lead generation
      function trackFormSubmit(formName, eventValue) {
        gtag('event', 'generate_lead', {
          'event_category': 'Form',
          'event_label': formName,
          'value': eventValue || 1
        });
      }
      
      // Track portfolio interactions
      function trackPortfolioView(projectId) {
        gtag('event', 'view_item', {
          'event_category': 'Portfolio',
          'event_label': projectId,
          'content_type': 'project'
        });
      }
      
      // Make tracking functions globally available
      window.trackFormSubmit = trackFormSubmit;
      window.trackPortfolioView = trackPortfolioView;
    </script>
    
    <!-- Theme and initial styles to prevent FOUC -->
    <style>
      /* Critical CSS - inline for performance */
      :root {
        --primary: #2a2a2a;
        --secondary: #3b82f6;
        --accent: #ffffff;
        --neutral: #f1f5f9;
        --text: #374151;
      }
      
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      html {
        font-family: 'Inter', system-ui, sans-serif;
        scroll-behavior: smooth;
      }
      
      body {
        background-color: var(--accent);
        color: var(--text);
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
      
      /* Loading state for GSAP animations */
      .gsap-loading {
        opacity: 0;
      }
      
      /* Reduced motion fallbacks */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
        
        html {
          scroll-behavior: auto;
        }
      }
    </style>
  </head>
  
  <body>
    <slot />
    
    <!-- GSAP CDN Direct Loading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js" integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js" integrity="sha512-onMTRKJBKz8M1TnqqDuGBlowlH0ohFzMXYRNebz+yOcc5TQr/zAKsthzhuv0hiyUKEiQEQXEynnXCvNTOk50dg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <!-- Initialize GSAP -->
    <script is:inline>
      // Initialize GSAP immediately
      document.addEventListener('DOMContentLoaded', function() {
        if (typeof gsap !== 'undefined' && typeof ScrollTrigger !== 'undefined') {
          const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
          
          // Register ScrollTrigger plugin
          gsap.registerPlugin(ScrollTrigger);
          
          // Set global defaults for performance
          gsap.defaults({
            ease: 'power2.out',
            duration: prefersReducedMotion ? 0.01 : 0.6,
            force3D: true
          });
          
          // Configure ScrollTrigger for performance
          ScrollTrigger.config({
            limitCallbacks: true,
            syncInterval: prefersReducedMotion ? 1000 : 150
          });
          
          // Mark GSAP as loaded
          window.gsapLoaded = true;
          
          // Refresh ScrollTrigger on resize (debounced)
          let resizeTimeout;
          window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(function() {
              ScrollTrigger.refresh();
            }, 250);
          });
        }
      });
      
      // Cleanup on page unload
      window.addEventListener('beforeunload', function() {
        if (typeof ScrollTrigger !== 'undefined') {
          ScrollTrigger.getAll().forEach(function(trigger) {
            trigger.kill();
          });
        }
      });
    </script>
  </body>
</html>